 {{> _header}}
 <div class="main">
   <h2>Dashboard</h2>
   <form  id="file-upload" action="/api/upload-file" method="post" enctype="multipart/form-data">
		<label for="file">File</label>
		<input id="file" name="file" type="file" />
		<button type="submit">Upload</button>
	</form>
  <div class="uploaded-documents">
   <h2>Uploaded Documents</h2>
   <div class="file-list">

   </div>
  </div>
 </div>

 <script>
  async function getFiles() {
    let res = await fetch("/api/files");
    let jsondata = await res.json();
    return jsondata.files;
  }
  function displayFiles(files) {
    let div = $(".file-list");
    $(div).empty();
    files.forEach( function(file) {
      $(div).append(`<div id="doc-${file.ID}" class="document"><div class="image"><img src="${file.file_url}"> 
     <div class="close"><img src="/images/close.jpeg"></div>
      </div>
     <div class="filename">${file.original_filename}</div>
     </div>`);
    });
  }
  $(document).ready(async function() {
    let files = await getFiles();
    console.log(files);
    displayFiles(files);

    $("div.close img").on("click", function(evt) {
      let doc = $(evt.target).closest("div.document");
      let docid = $(doc).attr("id");
      let mchresult = docid.match(/doc-(\d+)/);
      let id = mchresult[1];
      alert("click " + id);
      $(doc).fadeOut(1000, function() {
      });
    });

    $('#file-upload').on("submit", function(evt) { 
      console.log("Submit");
      evt.preventDefault();
      let formData = new FormData( $("#file-upload")[0] );
      let res = fetch("/api/upload-file", { method: "POST", body: formData } );
      console.log(res);
    });
  });
 </script>

 {{> _footer}}
